# Dockerfile.mcp â€” analyst_toolkit MCP Server
#
# Build:  docker build -f Dockerfile.mcp -t analyst-toolkit-mcp .
# Run:    docker-compose -f docker-compose.mcp.yml up
#
# The server exposes a JSON-RPC 2.0 /rpc endpoint on port 8001,
# compatible with fridai-core's HTTPRemoteClient.

FROM python:3.13-slim

WORKDIR /app

# Install dependencies first (layer cache)
# vendor/ holds pre-built wheels for packages not pulled from PyPI
COPY requirements-mcp.txt .
COPY vendor/ vendor/
RUN apt-get update && apt-get install -y --no-install-recommends git \
    && rm -rf /var/lib/apt/lists/* \
    && pip install --no-cache-dir vendor/analyst_toolkit_deploy-0.2.6-py3-none-any.whl \
    && pip install --no-cache-dir -r requirements-mcp.txt

# Copy toolkit source and config
COPY src/ src/
COPY config/ config/
ENV PYTHONPATH=/app/src

EXPOSE 8001

# Health check
HEALTHCHECK --interval=30s --timeout=5s --start-period=15s --retries=3 \
  CMD python -c "import urllib.request; urllib.request.urlopen('http://localhost:8001/health')"

CMD ["python", "-m", "analyst_toolkit.mcp_server.server"]
